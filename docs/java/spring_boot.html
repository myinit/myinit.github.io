<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Spring Boot（一）入门篇 | 前端知识</title>
    <meta name="generator" content="VuePress 1.5.2">
    
    <meta name="description" content="Mokou,源码解析,前端,Vue,Vue3,Es6,Javascript">
    <link rel="preload" href="/assets/css/0.styles.34d67128.css" as="style"><link rel="preload" href="/assets/js/app.da5e5cab.js" as="script"><link rel="preload" href="/assets/js/2.2bc50b5c.js" as="script"><link rel="preload" href="/assets/js/35.fc05f6e0.js" as="script"><link rel="prefetch" href="/assets/js/10.5afa6c98.js"><link rel="prefetch" href="/assets/js/11.7159faba.js"><link rel="prefetch" href="/assets/js/12.04b47d5c.js"><link rel="prefetch" href="/assets/js/13.33237a86.js"><link rel="prefetch" href="/assets/js/14.ab167d38.js"><link rel="prefetch" href="/assets/js/15.98949b39.js"><link rel="prefetch" href="/assets/js/16.4a2bdd8a.js"><link rel="prefetch" href="/assets/js/17.31ad3a0f.js"><link rel="prefetch" href="/assets/js/18.41427e8c.js"><link rel="prefetch" href="/assets/js/19.471930fa.js"><link rel="prefetch" href="/assets/js/20.34609147.js"><link rel="prefetch" href="/assets/js/21.454fc426.js"><link rel="prefetch" href="/assets/js/22.94fc50ce.js"><link rel="prefetch" href="/assets/js/23.7da09a58.js"><link rel="prefetch" href="/assets/js/24.0708c613.js"><link rel="prefetch" href="/assets/js/25.7d734217.js"><link rel="prefetch" href="/assets/js/26.dbba15b6.js"><link rel="prefetch" href="/assets/js/27.fbf70cd3.js"><link rel="prefetch" href="/assets/js/28.e2474813.js"><link rel="prefetch" href="/assets/js/29.efb48b7f.js"><link rel="prefetch" href="/assets/js/3.1a9e0b8f.js"><link rel="prefetch" href="/assets/js/30.6cd4682a.js"><link rel="prefetch" href="/assets/js/31.b60aceb1.js"><link rel="prefetch" href="/assets/js/32.2be0b486.js"><link rel="prefetch" href="/assets/js/33.4180f091.js"><link rel="prefetch" href="/assets/js/34.c7a0ccf0.js"><link rel="prefetch" href="/assets/js/36.b02d62d1.js"><link rel="prefetch" href="/assets/js/37.870aa908.js"><link rel="prefetch" href="/assets/js/38.112e270d.js"><link rel="prefetch" href="/assets/js/39.e2b199b9.js"><link rel="prefetch" href="/assets/js/4.d571c79c.js"><link rel="prefetch" href="/assets/js/40.4b21c256.js"><link rel="prefetch" href="/assets/js/41.ec6f1a3e.js"><link rel="prefetch" href="/assets/js/42.273a4070.js"><link rel="prefetch" href="/assets/js/43.195685f8.js"><link rel="prefetch" href="/assets/js/44.f23320bf.js"><link rel="prefetch" href="/assets/js/45.09676a4b.js"><link rel="prefetch" href="/assets/js/46.cb90e599.js"><link rel="prefetch" href="/assets/js/47.fe86ee10.js"><link rel="prefetch" href="/assets/js/48.e94890fd.js"><link rel="prefetch" href="/assets/js/49.ae3206b3.js"><link rel="prefetch" href="/assets/js/5.e24a0e2b.js"><link rel="prefetch" href="/assets/js/50.cbeb8f9a.js"><link rel="prefetch" href="/assets/js/51.6f3224f5.js"><link rel="prefetch" href="/assets/js/52.33c6e3ad.js"><link rel="prefetch" href="/assets/js/53.4ff5a34a.js"><link rel="prefetch" href="/assets/js/54.d384ca17.js"><link rel="prefetch" href="/assets/js/55.85a8de1d.js"><link rel="prefetch" href="/assets/js/56.02e6b73d.js"><link rel="prefetch" href="/assets/js/57.9c31601f.js"><link rel="prefetch" href="/assets/js/58.0d966891.js"><link rel="prefetch" href="/assets/js/59.18ce1da1.js"><link rel="prefetch" href="/assets/js/6.b6109b4f.js"><link rel="prefetch" href="/assets/js/60.b744966b.js"><link rel="prefetch" href="/assets/js/61.129cbf85.js"><link rel="prefetch" href="/assets/js/62.9552e4d5.js"><link rel="prefetch" href="/assets/js/63.d9b6fd4b.js"><link rel="prefetch" href="/assets/js/64.b6d27059.js"><link rel="prefetch" href="/assets/js/65.bc7da6ff.js"><link rel="prefetch" href="/assets/js/66.dd5aa73e.js"><link rel="prefetch" href="/assets/js/67.83dac889.js"><link rel="prefetch" href="/assets/js/68.94ad7166.js"><link rel="prefetch" href="/assets/js/69.55386e01.js"><link rel="prefetch" href="/assets/js/7.650cad16.js"><link rel="prefetch" href="/assets/js/70.315595ca.js"><link rel="prefetch" href="/assets/js/71.f4e03dbc.js"><link rel="prefetch" href="/assets/js/72.0580633e.js"><link rel="prefetch" href="/assets/js/8.76ea1f77.js"><link rel="prefetch" href="/assets/js/9.6594a171.js">
    <link rel="stylesheet" href="/assets/css/0.styles.34d67128.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/mh.jpg" alt="前端知识" class="logo"> <span class="site-name can-hide">前端知识</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  主页
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  主页
</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>前端知识</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Vue2 &amp;&amp; React</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>计算机基础</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>前端基础</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Flutter实战</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>服务端相关</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/java/begin.html" class="sidebar-link">Java常识</a></li><li><a href="/java/db.html" class="sidebar-link">数据库相关</a></li><li><a href="/java/spring_boot.html" aria-current="page" class="active sidebar-link">SpringBoot</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/node/NPM.html" class="sidebar-link">NPM机制</a></li><li><a href="https://github.com/zhongmeizhi/z-mock" target="_blank" rel="noopener noreferrer" class="sidebar-link">用Koa2撸一个API Mock<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>简单的API</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>其他</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="spring-boot（一）入门篇"><a href="#spring-boot（一）入门篇" class="header-anchor">#</a> Spring Boot（一）入门篇</h1> <h3 id="为什么会有-spring-boot-？"><a href="#为什么会有-spring-boot-？" class="header-anchor">#</a> 为什么会有 Spring Boot ？</h3> <p>虽然 <code>Spring</code> 的组件代码是轻量级的，但它的配置却是重量级的（需要大量XML配置）。<code>Spring Boot</code>的官方介绍：从本质上来说，Spring Boot就是Spring，<strong>它做了那些没有它你自己也会去做的Spring Bean配置</strong>。</p> <p>所以：Spring Boot 并不是一个新的框架， 而是默认配置了很多框架的使用方式。就像 Maven 整合了所有的 Jar 包，Spring Boot 整合了所有的框架。</p> <h3 id="环境搭建"><a href="#环境搭建" class="header-anchor">#</a> 环境搭建</h3> <h5 id="一、初始化项目"><a href="#一、初始化项目" class="header-anchor">#</a> 一、初始化项目</h5> <p>方式一：使用 <code>Idea</code> 编辑器操作。</p> <ol><li>首先 Java JDK 环境</li> <li>然后需要 Maven 环境</li> <li>在 Idea 编辑器中 new Project</li> <li>选择 Spring Initialize</li> <li>后续就是 Maven 的依赖选择了。（可之间next，后续再安装）</li> <li>选择 Maven auto import</li> <li>等依赖加载完成，即可运行项目</li></ol> <p>初始化项目方式二：</p> <ul><li>通过网站 <a href="https://start.spring.io/" target="_blank" rel="noopener noreferrer">https://start.spring.io/<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li>注意选择 <code>Spring Web</code> 模块</li></ul> <h5 id="二、安装依赖"><a href="#二、安装依赖" class="header-anchor">#</a> 二、安装依赖</h5> <p>通过 maven 安装依赖包。</p> <h5 id="三、运行"><a href="#三、运行" class="header-anchor">#</a> 三、运行</h5> <ol><li>通过 <code>application.properties</code> 文件配置 运行端口 <code>server.port=8333</code></li> <li>新建 <code>controller/HelloWorldController.java</code> 文件，</li></ol> <div class="language-java extra-class"><pre class="language-java"><code>  <span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>demo<span class="token punctuation">.</span>controller</span><span class="token punctuation">;</span>

  <span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation</span><span class="token punctuation">.</span><span class="token class-name">GetMapping</span><span class="token punctuation">;</span>
  <span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation</span><span class="token punctuation">.</span><span class="token class-name">RequestMapping</span><span class="token punctuation">;</span>
  <span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation</span><span class="token punctuation">.</span><span class="token class-name">RestController</span><span class="token punctuation">;</span>

  <span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util</span><span class="token punctuation">.</span><span class="token class-name">HashMap</span><span class="token punctuation">;</span>
  <span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util</span><span class="token punctuation">.</span><span class="token class-name">Map</span><span class="token punctuation">;</span>

  <span class="token annotation punctuation">@RestController</span>
  <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">&quot;test&quot;</span><span class="token punctuation">)</span>
  <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">HelloWorldController</span> <span class="token punctuation">{</span>
      <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;hello&quot;</span><span class="token punctuation">)</span>
      <span class="token keyword">public</span> <span class="token class-name">Map</span> <span class="token function">sayHello</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token class-name">Map</span> result <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          result<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;zmz&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          result<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;age&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;16&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token keyword">return</span> result<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
</code></pre></div><ol start="3"><li>运行</li> <li>打开 <code>http://localhost:8333/test/hello</code> 查看 XHR</li></ol> <h5 id="其他"><a href="#其他" class="header-anchor">#</a> 其他</h5> <p>Ideal 汉化</p> <ol><li>下载汉化包</li> <li>将 jar 包放入 <code>IntelliJ IDEA\lib</code> 目录下</li> <li>重启 Idea</li></ol> <p>简化代码</p> <ul><li>通过 <code>Lombok</code> 简化代码，但是很少有人用（维护不方便）</li> <li>通过 <code>JPA</code> 维护 SQL，（单表查询很方便，多表查询不好用且性能会变差）</li></ul> <h3 id="主注解"><a href="#主注解" class="header-anchor">#</a> 主注解</h3> <ol><li><code>@SpringBootApplication</code>: 创建 SpringBoot 项目之后会默认在主类</li> <li><code>@EnableAutoConfiguration</code>: 启用 SpringBoot 的自动配置机制</li> <li><code>@ComponentScan</code>: 扫描被 @Component (@Service,@Controller) 注解的 Bean，注解默认会扫描该类所在的包下所有的类。</li> <li><code>@Configuration</code>: 声明配置类，可以使用 <code>@Component</code> 代替（这样就失去了语义化）</li></ol> <h3 id="spring-bean-相关"><a href="#spring-bean-相关" class="header-anchor">#</a> Spring Bean 相关</h3> <p><code>@Autowired</code>: 自动导入对象到类中，被注入进的类同样要被 Spring 容器管理比如</p> <p>通过下面的注解，可以把类标识成可用于 <code>@Autowired</code> 注解自动装配的 bean 的类</p> <ol><li><code>@Component</code>: 通用的注解，可标注任意类为 Spring 组件。如果一个 Bean 不知道属于哪个层，可以使用@Component 注解标注。</li> <li><code>@Repository</code>: 对应持久层即 Dao 层，主要用于数据库相关操作。</li> <li><code>@Service</code>: 对应服务层，主要涉及一些复杂的逻辑，需要用到 Dao 层</li> <li><code>@Controller</code>: 对应 Spring MVC 控制层，主要用户接受用户请求并调用 Service 层返回数据给前端页面。</li></ol> <h3 id="请求相关"><a href="#请求相关" class="header-anchor">#</a> 请求相关</h3> <ul><li><code>@RestController</code> 将返回的对象数据直接以 JSON 或 XML 形式写入 HTTP 响应(Response)中，大部分都是 <code>JSON</code> 形式
<ul><li><code>@RestController</code> = <code>@Controller</code> + <code>@ResponseBody</code></li> <li><code>@RequestBody</code> :将 <code>HttpRequest body</code> 中的 JSON 类型数据反序列化为合适的 Java 类型。</li></ul></li> <li><code>@RequestMapping</code> 默认映射所有 HTTP Action (GET、PUT、POST 等)
<ul><li>使用 <code>@RequestMapping(method=ActionType)</code> 来缩小这个映射。</li> <li><code>@PostMapping</code> 等价于 <code>@RequestMapping(method = RequestMethod.POST)</code></li> <li><code>@GetMapping</code></li> <li><code>@DeleteMapping</code></li> <li><code>@PutMapping</code></li> <li><code>@PatchMapping</code></li></ul></li> <li><code>@PathVariable</code> :取url地址中的参数</li> <li><code>@RequestParam</code> :取url的查询参数值。</li></ul> <p>ResponseEntity: 表示整个HTTP Response：状态码，标头和正文内容。我们可以使用它来自定义HTTP Response 的内容。</p> <h3 id="scope"><a href="#scope" class="header-anchor">#</a> @Scope</h3> <p>声明 Spring Bean 的作用域，使用方法:</p> <div class="language-java extra-class"><pre class="language-java"><code>    <span class="token annotation punctuation">@Bean</span>
    <span class="token annotation punctuation">@Scope</span><span class="token punctuation">(</span><span class="token string">&quot;singleton&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">Person</span> <span class="token function">personSingleton</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre></div><p>四种常见的 Spring Bean 的作用域：</p> <ol><li><code>singleton</code>: 唯一 bean 实例，Spring 中的 bean 默认都是单例的。</li> <li><code>prototype</code>: 每次请求都会创建一个新的 bean 实例。</li> <li><code>request</code>: 每一次 HTTP 请求都会产生一个新的 bean，该 bean 仅在当前 HTTP request 内有效。</li> <li><code>session</code>: 每一次 HTTP 请求都会产生一个新的 bean，该 bean 仅在当前 HTTP session 内有效。</li></ol> <h3 id="参数校验"><a href="#参数校验" class="header-anchor">#</a> 参数校验</h3> <p>SpringBoot 项目的 spring-boot-starter-web 依赖中已经有 hibernate-validator 包，不需要引用相关依赖。</p> <p>常用的字段验证的注解</p> <ul><li><code>@NotEmpty</code> 被注释的字符串的不能为 null 也不能为空</li> <li><code>@NotBlank</code> 被注释的字符串非 null，并且必须包含一个非空白字符</li> <li><code>@Null</code> 被注释的元素必须为 null</li> <li><code>@NotNull</code> 被注释的元素必须不为 null</li> <li><code>@AssertTrue</code> 被注释的元素必须为 true</li> <li><code>@AssertFalse</code> 被注释的元素必须为 false</li> <li><code>@Pattern(regex=,flag=)</code> 被注释的元素必须符合指定的正则表达式</li> <li><code>@Email</code> 被注释的元素必须是 Email 格式。</li> <li><code>@Min(value)</code> 被注释的元素必须是一个数字，其值必须大于等于指定的最小值</li> <li><code>@Max(value)</code> 被注释的元素必须是一个数字，其值必须小于等于指定的最大值</li> <li><code>@DecimalMin(value)</code> 被注释的元素必须是一个数字，其值必须大于等于指定的最小值</li> <li><code>@DecimalMax(value)</code> 被注释的元素必须是一个数字，其值必须小于等于指定的最大值</li> <li><code>@Size(max=, min=)</code> 被注释的元素的大小必须在指定的范围内</li> <li><code>@Digits (integer, fraction)</code> 被注释的元素必须是一个数字，其值必须在可接受的范围内</li> <li><code>@Past</code> 被注释的元素必须是一个过去的日期</li> <li><code>@Future</code> 被注释的元素必须是一个将来的日期</li></ul> <p>在需要验证的参数上加上了 <code>@Valid</code> 注解，如果验证失败，它将抛出 <code>MethodArgumentNotValidException</code>
通过在类上添加 <code>@Validated</code> 注解，这个参数可以告诉 Spring 去校验方法参数。</p> <div class="language-java extra-class"><pre class="language-java"><code>    <span class="token annotation punctuation">@RestController</span>
    <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/api&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PersonController</span> <span class="token punctuation">{</span>

        <span class="token annotation punctuation">@PostMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/person&quot;</span><span class="token punctuation">)</span>
        <span class="token keyword">public</span> <span class="token class-name">ResponseEntity</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Person</span><span class="token punctuation">&gt;</span></span> <span class="token function">getPerson</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestBody</span> <span class="token annotation punctuation">@Valid</span> <span class="token class-name">Person</span> person<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token class-name">ResponseEntity</span><span class="token punctuation">.</span><span class="token function">ok</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">body</span><span class="token punctuation">(</span>person<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</code></pre></div><h3 id="事务-transactional"><a href="#事务-transactional" class="header-anchor">#</a> 事务 @Transactional</h3> <p>在 <code>@Transactional</code> 注解中如果不配置 rollbackFor 属性,那么事物只会在遇到 RuntimeException 的时候才会回滚,加上 <code>rollbackFor=Exception.class</code>,可以让事物在遇到非运行时异常时也回滚。</p> <div class="language-java extra-class"><pre class="language-java"><code>    <span class="token annotation punctuation">@Transactional</span><span class="token punctuation">(</span>rollbackFor <span class="token operator">=</span> <span class="token class-name">Exception</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">save</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 略</span>
    <span class="token punctuation">}</span>
</code></pre></div><ul><li>作用于类：当把 @Transactional 注解放在类上时，表示所有该类的 public 方法都配置相同的事务属性信息。</li> <li>作用于方法：当类配置了 @Transactional，方法也配置了 @Transactional，方法的事务会覆盖类的事务配置信息。</li></ul> <h3 id="请求过滤和拦截"><a href="#请求过滤和拦截" class="header-anchor">#</a> 请求过滤和拦截</h3> <p>过滤器（Filter）：当你有一堆东西的时候，你只希望选择符合你要求的某一些东西。定义这些要求的工具，就是过滤器。</p> <ul><li>通过实现 <code>javax.Servlet.Filter</code>接口：注册过滤器
拦截器（Interceptor）：在一个流程正在进行的时候，你希望干预它的进展，甚至终止它进行，这是拦截器做的事情。</li> <li>通过继承 <code>servlet.handler.HandlerInterceptorAdapter</code> 类：注册拦截器</li></ul> <h3 id="使用-yml-配置文件"><a href="#使用-yml-配置文件" class="header-anchor">#</a> 使用 yml 配置文件</h3> <p>在 <code>application.properties</code> 统计目录添加 <code>application.yml</code></p> <p>yml 添加内容 如下</p> <div class="language-yml extra-class"><pre class="language-yml"><code>  <span class="token key atrule">myself</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> Mokou
  <span class="token key atrule">age</span><span class="token punctuation">:</span> <span class="token number">16</span>
</code></pre></div><p>最简单的使用方法，使用 <code>@value</code></p> <ul><li>例如：在 class 中添加</li></ul> <div class="language- extra-class"><pre><code>```java
  @Value(&quot;${myself.age}&quot;)
  private String age;
```
</code></pre></div><p>如果需要一个 <code>JavaBean</code> 来专门映射配置的话, 一般使用 <code>@ConfigurationProperties</code> 读取.</p> <ol><li>添加 <code>config/Myself.java</code></li></ol> <div class="language- extra-class"><pre><code>```java
  @Component // 不加这个注解的话, 使用 @Autowired 就不能注入进去了
  @ConfigurationProperties(prefix = &quot;myself&quot;) // 配置文件中的前缀
  public class Myself {
      private String name;

      public String getName() {
          return name;
      }

      public void setName(String name) {
          this.name = name;
      }

      private String age;

      public String getAge() {
          return age;
      }

      public void setAge(String age) {
          this.age = age;
      }
  }
```
1. 引入
  ```java
    @Autowired
    private Myself myself;
  ```
2. 使用
  ```java
    System.out.println(myself.getName());
  ```
</code></pre></div><p>第三种方法：使用 <code>@Environment</code>，但是没人用</p> <h3 id="全局异常处理"><a href="#全局异常处理" class="header-anchor">#</a> 全局异常处理</h3> <p>使用 <code>@ControllerAdvice</code> 和 <code>@ExceptionHandler</code> 处理全局异常</p> <ul><li><code>@ControllerAdvice</code> :注解定义全局异常处理类</li> <li><code>@ExceptionHandler</code> :注解声明异常处理方法</li></ul> <h3 id="异步"><a href="#异步" class="header-anchor">#</a> 异步</h3> <p>如果我们需要在 SpringBoot 实现异步编程的话，通过 Spring 提供的两个注解会让这件事情变的非常简单。</p> <ul><li><code>@EnableAsync</code>：通过在 配置类或者Main类 上加 <code>@EnableAsync</code> 开启对异步方法的支持。</li> <li><code>@Async</code> 可以作用在类上或者方法上，作用在类上代表这个类的所有方法都是异步方法。</li></ul> <h3 id="spring-schedule-实现定时任务"><a href="#spring-schedule-实现定时任务" class="header-anchor">#</a> Spring Schedule 实现定时任务</h3> <p>schedule（译：时间表、计划表）, <a href="http://cron.qqe2.com/" target="_blank" rel="noopener noreferrer">在线Cron表达式生成器<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <ol><li>创建一个 scheduled task</li></ol> <p><code>@Scheduled</code>：创建一个定时任务，包括：固定速率执行、固定延迟执行、初始延迟执行、使用 Cron 表达式执行定时任务。</p> <div class="language-java extra-class"><pre class="language-java"><code>  <span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>slf4j</span><span class="token punctuation">.</span><span class="token class-name">Logger</span><span class="token punctuation">;</span>
  <span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>slf4j</span><span class="token punctuation">.</span><span class="token class-name">LoggerFactory</span><span class="token punctuation">;</span>
  <span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>scheduling<span class="token punctuation">.</span>annotation</span><span class="token punctuation">.</span><span class="token class-name">Scheduled</span><span class="token punctuation">;</span>
  <span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype</span><span class="token punctuation">.</span><span class="token class-name">Component</span><span class="token punctuation">;</span>

  <span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>text</span><span class="token punctuation">.</span><span class="token class-name">SimpleDateFormat</span><span class="token punctuation">;</span>
  <span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util</span><span class="token punctuation">.</span><span class="token class-name">Date</span><span class="token punctuation">;</span>
  <span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent</span><span class="token punctuation">.</span><span class="token class-name">TimeUnit</span><span class="token punctuation">;</span>

  <span class="token annotation punctuation">@Component</span>
  <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ScheduledTasks</span> <span class="token punctuation">{</span>
      <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">Logger</span> log <span class="token operator">=</span> <span class="token class-name">LoggerFactory</span><span class="token punctuation">.</span><span class="token function">getLogger</span><span class="token punctuation">(</span><span class="token class-name">ScheduledTasks</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">SimpleDateFormat</span> dateFormat <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SimpleDateFormat</span><span class="token punctuation">(</span><span class="token string">&quot;HH:mm:ss&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token comment">/**
      * fixedRate：固定速率执行。每5秒执行一次。
      */</span>
      <span class="token annotation punctuation">@Scheduled</span><span class="token punctuation">(</span>fixedRate <span class="token operator">=</span> <span class="token number">5000</span><span class="token punctuation">)</span>
      <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">reportCurrentTimeWithFixedRate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;Current Thread : {}&quot;</span><span class="token punctuation">,</span> <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;Fixed Rate Task : The time is now {}&quot;</span><span class="token punctuation">,</span> dateFormat<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>

      <span class="token comment">/**
      * fixedDelay：固定延迟执行。距离上一次调用成功后2秒才执。
      */</span>
      <span class="token annotation punctuation">@Scheduled</span><span class="token punctuation">(</span>fixedDelay <span class="token operator">=</span> <span class="token number">2000</span><span class="token punctuation">)</span>
      <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">reportCurrentTimeWithFixedDelay</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">try</span> <span class="token punctuation">{</span>
              <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>SECONDS<span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
              log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;Fixed Delay Task : The time is now {}&quot;</span><span class="token punctuation">,</span> dateFormat<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
              e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>

      <span class="token comment">/**
      * initialDelay:初始延迟。任务的第一次执行将延迟5秒，然后将以5秒的固定间隔执行。
      */</span>
      <span class="token annotation punctuation">@Scheduled</span><span class="token punctuation">(</span>initialDelay <span class="token operator">=</span> <span class="token number">5000</span><span class="token punctuation">,</span> fixedRate <span class="token operator">=</span> <span class="token number">5000</span><span class="token punctuation">)</span>
      <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">reportCurrentTimeWithInitialDelay</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;Fixed Rate Task with Initial Delay : The time is now {}&quot;</span><span class="token punctuation">,</span> dateFormat<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>

      <span class="token comment">/**
      * cron：使用Cron表达式。　每分钟的1，2秒运行
      */</span>
      <span class="token annotation punctuation">@Scheduled</span><span class="token punctuation">(</span>cron <span class="token operator">=</span> <span class="token string">&quot;1-2 * * * * ? &quot;</span><span class="token punctuation">)</span>
      <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">reportCurrentTimeWithCronExpression</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;Cron Expression: The time is now {}&quot;</span><span class="token punctuation">,</span> dateFormat<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
</code></pre></div><ol start="2"><li>启动类上加上 @EnableScheduling 注解</li></ol> <p>在 SpringBoot 中我们只需要在启动类上加上 <code>@EnableScheduling</code> 便可以启动定时任务了。</p> <div class="language-java extra-class"><pre class="language-java"><code>  <span class="token annotation punctuation">@SpringBootApplication</span>
  <span class="token annotation punctuation">@EnableScheduling</span>
  <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DemoApplication</span> <span class="token punctuation">{</span>
      <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token class-name">SpringApplication</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">DemoApplication</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
</code></pre></div><ol start="3"><li>自定义线程池执行 scheduled task</li></ol> <p>默认情况下，<code>@Scheduled</code> 任务都在Spring创建的大小为1的默认线程池中执行</p> <p>如果需要自定义线程池执行只需要新加一个实现 <code>SchedulingConfigurer</code> 接口的 <code>configureTasks</code> 的类即可，这个类需要加上 <code>@Configuration</code> 注解。</p> <div class="language-java extra-class"><pre class="language-java"><code>  <span class="token annotation punctuation">@Configuration</span>
  <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SchedulerConfig</span> <span class="token keyword">implements</span> <span class="token class-name">SchedulingConfigurer</span> <span class="token punctuation">{</span>
      <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token keyword">int</span> POOL_SIZE <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>

      <span class="token annotation punctuation">@Override</span>
      <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">configureTasks</span><span class="token punctuation">(</span><span class="token class-name">ScheduledTaskRegistrar</span> scheduledTaskRegistrar<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token class-name">ThreadPoolTaskScheduler</span> threadPoolTaskScheduler <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ThreadPoolTaskScheduler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

          threadPoolTaskScheduler<span class="token punctuation">.</span><span class="token function">setPoolSize</span><span class="token punctuation">(</span>POOL_SIZE<span class="token punctuation">)</span><span class="token punctuation">;</span>
          threadPoolTaskScheduler<span class="token punctuation">.</span><span class="token function">setThreadNamePrefix</span><span class="token punctuation">(</span><span class="token string">&quot;my-scheduled-task-pool-&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          threadPoolTaskScheduler<span class="token punctuation">.</span><span class="token function">initialize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

          scheduledTaskRegistrar<span class="token punctuation">.</span><span class="token function">setTaskScheduler</span><span class="token punctuation">(</span>threadPoolTaskScheduler<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
</code></pre></div><ol start="4"><li>@EnableAsync 和 @Async 使定时任务并行执行</li></ol> <p>如果想要代码并行执行，可以使用 <code>@EnableAsync</code> 和 <code>@Async</code> 这两个注解实现</p> <div class="language-java extra-class"><pre class="language-java"><code>  <span class="token annotation punctuation">@Component</span>
  <span class="token annotation punctuation">@EnableAsync</span>
  <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AsyncScheduledTasks</span> <span class="token punctuation">{</span>
      <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">Logger</span> log <span class="token operator">=</span> <span class="token class-name">LoggerFactory</span><span class="token punctuation">.</span><span class="token function">getLogger</span><span class="token punctuation">(</span><span class="token class-name">AsyncScheduledTasks</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">SimpleDateFormat</span> dateFormat <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SimpleDateFormat</span><span class="token punctuation">(</span><span class="token string">&quot;HH:mm:ss&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token comment">/**
      * fixedDelay：固定延迟执行。距离上一次调用成功后2秒才执。
      */</span>
      <span class="token comment">//@Async</span>
      <span class="token annotation punctuation">@Scheduled</span><span class="token punctuation">(</span>fixedDelay <span class="token operator">=</span> <span class="token number">2000</span><span class="token punctuation">)</span>
      <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">reportCurrentTimeWithFixedDelay</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">try</span> <span class="token punctuation">{</span>
              <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>SECONDS<span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
              log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;Fixed Delay Task : The time is now {}&quot;</span><span class="token punctuation">,</span> dateFormat<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
              e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
</code></pre></div><p>因为 <code>@Scheduled</code> 任务都在Spring创建的大小为1的默认线程池中执行。如果不使用 <code>@Async</code> 程序会因为 <code>sleep(3)</code>，使 <code>reportCurrentTimeWithFixedDelay</code> 方法 5s 调用1次。</p> <p>使用 <code>@EnableAsync</code> 和 <code>@Async</code> 后，<code>reportCurrentTimeWithFixedDelay</code> 每 2s 调用1次。</p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/java/db.html" class="prev">
        数据库相关
      </a></span> <span class="next"><a href="/node/NPM.html">
        NPM机制
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.da5e5cab.js" defer></script><script src="/assets/js/2.2bc50b5c.js" defer></script><script src="/assets/js/35.fc05f6e0.js" defer></script>
  </body>
</html>
